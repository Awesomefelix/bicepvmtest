trigger:
  branches:
    include:
      - main

pool:
  name: 'flxbuilder'  # Custom self-hosted agent pool

variables:
  location: 'eastus'
  rgName: 'bicep-vm-rg'
  templateFile: 'main.bicep'
  deploymentName: 'bicepInfraDeployment'

stages:
  - stage: Deploy
    displayName: Deploy Infrastructure
    jobs:
      - job: DeployInfra
        displayName: Deploy Bicep Template to Azure
        steps:
          - checkout: self

          - task: AzureCLI@2
            displayName: 'Deploy Bicep Template'
            inputs:
              azureSubscription: 'FLX'  # Your service connection name
              scriptType: 'ps'           # Use PowerShell for Windows agents
              scriptLocation: 